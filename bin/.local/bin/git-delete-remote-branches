#!/bin/bash

# Use fzf to delete remote branches

if git remote get-url origin | grep -q -E 'github\.com.mikepqr'; then
    # this a repo in my personal account
    branchfilter=''
else
    # this is not my repo, so only offer to delete "my" branches
    branchfilter='mleewilliams'
fi

branches=$(git branch --all |
    # don't offer main
    grep --invert-match -E '(main|master)' |
    # only offer remote branches on origin that belong to me
    grep -E '^\s.remotes/origin/'"${branchfilter}" |
    cut -c 3- |
    fzf --multi --preview-window=bottom:40% --preview="git log {} --")

if [[ -n "$branches" ]]; then
    printf "%s" "${branches}" |
        awk -F/ '{ print $3 }' |
        xargs git push --delete origin
fi
